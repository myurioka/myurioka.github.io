[{"data":1,"prerenderedAt":780},["ShallowReactive",2],{"category-data-wasm":3},[4],{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":9,"description":10,"date":11,"image":12,"alt":13,"ogImage":14,"tags":15,"published":19,"body":20,"_type":773,"_id":774,"_source":775,"_file":776,"_stem":777,"_extension":778,"sitemap":779},"/blogs/fetch-content-data-render-pages","blogs",false,"","Game Loop in Rust & Wasm",null,"20th Oct 2024","/blogs-img/20241013.png","You can't make a game without a game loop.","/blogs-img/blog4.jpg",[16,17,18],"rust","wasm","webassembly",true,{"type":21,"children":22,"toc":768},"root",[23,31,38,43,48,60,65,75,81,91,304,314,322,751,757,762],{"type":24,"tag":25,"props":26,"children":27},"element","p",{},[28],{"type":29,"value":30},"text","I find understandig the game loop really engoyable.",{"type":24,"tag":32,"props":33,"children":35},"h3",{"id":34},"introduction",[36],{"type":29,"value":37},"Introduction",{"type":24,"tag":25,"props":39,"children":40},{},[41],{"type":29,"value":42},"In the programming I usually do, a game loop is not necessary.\nHowever, it is necessary when programing games.",{"type":24,"tag":25,"props":44,"children":45},{},[46],{"type":29,"value":47},"I'm going to share some insights from my experience implementing a game loop with Rust and WASM.",{"type":24,"tag":25,"props":49,"children":50},{},[51],{"type":24,"tag":52,"props":53,"children":57},"a",{"href":54,"rel":55},"https://github.com/myurioka/cart",[56],"nofollow",[58],{"type":29,"value":59},"cart / Programing Retro Game in Rust & Wasm in Github",{"type":24,"tag":25,"props":61,"children":62},{},[63],{"type":29,"value":64},"Here are the websites I referred to when coding the game loop.",{"type":24,"tag":25,"props":66,"children":67},{},[68],{"type":24,"tag":52,"props":69,"children":72},{"href":70,"rel":71},"https://github.com/PacktPublishing/Game-Development-with-Rust-and-WebAssembly",[56],[73],{"type":29,"value":74},"Game-Development-with-Rust-and-WebAssembly",{"type":24,"tag":32,"props":76,"children":78},{"id":77},"what-i-enjoyed-most-about-programing-a-game-loop",[79],{"type":29,"value":80},"What I enjoyed most about programing a game loop",{"type":24,"tag":82,"props":83,"children":84},"ul",{},[85],{"type":24,"tag":86,"props":87,"children":88},"li",{},[89],{"type":29,"value":90},"The code has implemented a sophisticated technique to synchronize rendering with the browser's actual frame rate.",{"type":24,"tag":92,"props":93,"children":97},"pre",{"className":94,"code":95,"language":96,"meta":8,"style":8},"language-js shiki shiki-themes dracula","const FRAME_SIZE: f64 = 1.0 / 60.0 * 1000.0;\n\nwhile game_loop.accumulated_delta > FRAME_SIZE {\n    game.update(&keystate);\n    game_loop.accumulated_delta -= FRAME_SIZE;\n}\ngame_loop.last_frame = perf;\ngame.draw(&renderer);\n","js",[98],{"type":24,"tag":99,"props":100,"children":101},"code",{"__ignoreMap":8},[102,167,176,200,230,249,258,277],{"type":24,"tag":103,"props":104,"children":107},"span",{"class":105,"line":106},"line",1,[108,114,120,125,131,136,142,147,152,157,162],{"type":24,"tag":103,"props":109,"children":111},{"style":110},"--shiki-default:#FF79C6",[112],{"type":29,"value":113},"const",{"type":24,"tag":103,"props":115,"children":117},{"style":116},"--shiki-default:#F8F8F2",[118],{"type":29,"value":119}," FRAME_SIZE",{"type":24,"tag":103,"props":121,"children":122},{"style":110},[123],{"type":29,"value":124},":",{"type":24,"tag":103,"props":126,"children":128},{"style":127},"--shiki-default:#8BE9FD;--shiki-default-font-style:italic",[129],{"type":29,"value":130}," f64",{"type":24,"tag":103,"props":132,"children":133},{"style":110},[134],{"type":29,"value":135}," =",{"type":24,"tag":103,"props":137,"children":139},{"style":138},"--shiki-default:#BD93F9",[140],{"type":29,"value":141}," 1.0",{"type":24,"tag":103,"props":143,"children":144},{"style":110},[145],{"type":29,"value":146}," /",{"type":24,"tag":103,"props":148,"children":149},{"style":138},[150],{"type":29,"value":151}," 60.0",{"type":24,"tag":103,"props":153,"children":154},{"style":110},[155],{"type":29,"value":156}," *",{"type":24,"tag":103,"props":158,"children":159},{"style":138},[160],{"type":29,"value":161}," 1000.0",{"type":24,"tag":103,"props":163,"children":164},{"style":116},[165],{"type":29,"value":166},";\n",{"type":24,"tag":103,"props":168,"children":170},{"class":105,"line":169},2,[171],{"type":24,"tag":103,"props":172,"children":173},{"emptyLinePlaceholder":19},[174],{"type":29,"value":175},"\n",{"type":24,"tag":103,"props":177,"children":179},{"class":105,"line":178},3,[180,185,190,195],{"type":24,"tag":103,"props":181,"children":182},{"style":110},[183],{"type":29,"value":184},"while",{"type":24,"tag":103,"props":186,"children":187},{"style":116},[188],{"type":29,"value":189}," game_loop.accumulated_delta ",{"type":24,"tag":103,"props":191,"children":192},{"style":110},[193],{"type":29,"value":194},">",{"type":24,"tag":103,"props":196,"children":197},{"style":116},[198],{"type":29,"value":199}," FRAME_SIZE {\n",{"type":24,"tag":103,"props":201,"children":203},{"class":105,"line":202},4,[204,209,215,220,225],{"type":24,"tag":103,"props":205,"children":206},{"style":116},[207],{"type":29,"value":208},"    game.",{"type":24,"tag":103,"props":210,"children":212},{"style":211},"--shiki-default:#50FA7B",[213],{"type":29,"value":214},"update",{"type":24,"tag":103,"props":216,"children":217},{"style":116},[218],{"type":29,"value":219},"(",{"type":24,"tag":103,"props":221,"children":222},{"style":110},[223],{"type":29,"value":224},"&",{"type":24,"tag":103,"props":226,"children":227},{"style":116},[228],{"type":29,"value":229},"keystate);\n",{"type":24,"tag":103,"props":231,"children":233},{"class":105,"line":232},5,[234,239,244],{"type":24,"tag":103,"props":235,"children":236},{"style":116},[237],{"type":29,"value":238},"    game_loop.accumulated_delta ",{"type":24,"tag":103,"props":240,"children":241},{"style":110},[242],{"type":29,"value":243},"-=",{"type":24,"tag":103,"props":245,"children":246},{"style":116},[247],{"type":29,"value":248}," FRAME_SIZE;\n",{"type":24,"tag":103,"props":250,"children":252},{"class":105,"line":251},6,[253],{"type":24,"tag":103,"props":254,"children":255},{"style":116},[256],{"type":29,"value":257},"}\n",{"type":24,"tag":103,"props":259,"children":261},{"class":105,"line":260},7,[262,267,272],{"type":24,"tag":103,"props":263,"children":264},{"style":116},[265],{"type":29,"value":266},"game_loop.last_frame ",{"type":24,"tag":103,"props":268,"children":269},{"style":110},[270],{"type":29,"value":271},"=",{"type":24,"tag":103,"props":273,"children":274},{"style":116},[275],{"type":29,"value":276}," perf;\n",{"type":24,"tag":103,"props":278,"children":280},{"class":105,"line":279},8,[281,286,291,295,299],{"type":24,"tag":103,"props":282,"children":283},{"style":116},[284],{"type":29,"value":285},"game.",{"type":24,"tag":103,"props":287,"children":288},{"style":211},[289],{"type":29,"value":290},"draw",{"type":24,"tag":103,"props":292,"children":293},{"style":116},[294],{"type":29,"value":219},{"type":24,"tag":103,"props":296,"children":297},{"style":110},[298],{"type":29,"value":224},{"type":24,"tag":103,"props":300,"children":301},{"style":116},[302],{"type":29,"value":303},"renderer);\n",{"type":24,"tag":25,"props":305,"children":306},{},[307],{"type":24,"tag":52,"props":308,"children":311},{"href":309,"rel":310},"https://developer.mozilla.org/en-US/docs/Glossary/FPS",[56],[312],{"type":29,"value":313},"Browser Frame rate(FPS)",{"type":24,"tag":82,"props":315,"children":316},{},[317],{"type":24,"tag":86,"props":318,"children":319},{},[320],{"type":29,"value":321},"Rust ownership, particularly the concept of borrowing and lifetimes, is crucial for understanding this implementation.",{"type":24,"tag":92,"props":323,"children":325},{"className":94,"code":324,"language":96,"meta":8,"style":8},"impl GameLoop {\n    let f: SharedLoopClosure = Rc::new(RefCell::new(None));\n    let g = f.clone();\n    let mut keystate = KeyState::new();\n    *g.borrow_mut() = Some(browser::create_raf_closure(move |perf: f64| {\n        let _= browser::request_animation_frame(f.borrow().as_ref().unwrap());\n    }));\n    browser::request_animation_frame(\n        g.borrow()\n            .as_ref()\n            .ok_or_else(|| anyhow!(\"GameLoop: Loop is None\"))?,\n    )?;\n    Ok(())\n}\n",[326],{"type":24,"tag":99,"props":327,"children":328},{"__ignoreMap":8},[329,337,407,434,463,529,585,593,610,628,645,712,729,743],{"type":24,"tag":103,"props":330,"children":331},{"class":105,"line":106},[332],{"type":24,"tag":103,"props":333,"children":334},{"style":116},[335],{"type":29,"value":336},"impl GameLoop {\n",{"type":24,"tag":103,"props":338,"children":339},{"class":105,"line":169},[340,345,350,354,359,363,368,374,378,384,389,393,397,402],{"type":24,"tag":103,"props":341,"children":342},{"style":110},[343],{"type":29,"value":344},"    let",{"type":24,"tag":103,"props":346,"children":347},{"style":116},[348],{"type":29,"value":349}," f",{"type":24,"tag":103,"props":351,"children":352},{"style":110},[353],{"type":29,"value":124},{"type":24,"tag":103,"props":355,"children":356},{"style":127},[357],{"type":29,"value":358}," SharedLoopClosure",{"type":24,"tag":103,"props":360,"children":361},{"style":110},[362],{"type":29,"value":135},{"type":24,"tag":103,"props":364,"children":365},{"style":116},[366],{"type":29,"value":367}," Rc::",{"type":24,"tag":103,"props":369,"children":371},{"style":370},"--shiki-default:#FF79C6;--shiki-default-font-weight:bold",[372],{"type":29,"value":373},"new",{"type":24,"tag":103,"props":375,"children":376},{"style":116},[377],{"type":29,"value":219},{"type":24,"tag":103,"props":379,"children":381},{"style":380},"--shiki-default:#FFB86C;--shiki-default-font-style:italic",[382],{"type":29,"value":383},"RefCell",{"type":24,"tag":103,"props":385,"children":386},{"style":110},[387],{"type":29,"value":388},"::",{"type":24,"tag":103,"props":390,"children":391},{"style":370},[392],{"type":29,"value":373},{"type":24,"tag":103,"props":394,"children":395},{"style":116},[396],{"type":29,"value":219},{"type":24,"tag":103,"props":398,"children":399},{"style":380},[400],{"type":29,"value":401},"None",{"type":24,"tag":103,"props":403,"children":404},{"style":116},[405],{"type":29,"value":406},"));\n",{"type":24,"tag":103,"props":408,"children":409},{"class":105,"line":178},[410,415,419,424,429],{"type":24,"tag":103,"props":411,"children":412},{"style":116},[413],{"type":29,"value":414},"    let g ",{"type":24,"tag":103,"props":416,"children":417},{"style":110},[418],{"type":29,"value":271},{"type":24,"tag":103,"props":420,"children":421},{"style":116},[422],{"type":29,"value":423}," f.",{"type":24,"tag":103,"props":425,"children":426},{"style":211},[427],{"type":29,"value":428},"clone",{"type":24,"tag":103,"props":430,"children":431},{"style":116},[432],{"type":29,"value":433},"();\n",{"type":24,"tag":103,"props":435,"children":436},{"class":105,"line":202},[437,441,446,450,455,459],{"type":24,"tag":103,"props":438,"children":439},{"style":110},[440],{"type":29,"value":344},{"type":24,"tag":103,"props":442,"children":443},{"style":116},[444],{"type":29,"value":445}," mut keystate ",{"type":24,"tag":103,"props":447,"children":448},{"style":110},[449],{"type":29,"value":271},{"type":24,"tag":103,"props":451,"children":452},{"style":116},[453],{"type":29,"value":454}," KeyState::",{"type":24,"tag":103,"props":456,"children":457},{"style":370},[458],{"type":29,"value":373},{"type":24,"tag":103,"props":460,"children":461},{"style":116},[462],{"type":29,"value":433},{"type":24,"tag":103,"props":464,"children":465},{"class":105,"line":232},[466,471,476,481,486,490,495,500,505,510,515,520,524],{"type":24,"tag":103,"props":467,"children":468},{"style":110},[469],{"type":29,"value":470},"    *",{"type":24,"tag":103,"props":472,"children":473},{"style":116},[474],{"type":29,"value":475},"g.",{"type":24,"tag":103,"props":477,"children":478},{"style":211},[479],{"type":29,"value":480},"borrow_mut",{"type":24,"tag":103,"props":482,"children":483},{"style":116},[484],{"type":29,"value":485},"() ",{"type":24,"tag":103,"props":487,"children":488},{"style":110},[489],{"type":29,"value":271},{"type":24,"tag":103,"props":491,"children":492},{"style":211},[493],{"type":29,"value":494}," Some",{"type":24,"tag":103,"props":496,"children":497},{"style":116},[498],{"type":29,"value":499},"(browser::",{"type":24,"tag":103,"props":501,"children":502},{"style":211},[503],{"type":29,"value":504},"create_raf_closure",{"type":24,"tag":103,"props":506,"children":507},{"style":116},[508],{"type":29,"value":509},"(move ",{"type":24,"tag":103,"props":511,"children":512},{"style":110},[513],{"type":29,"value":514},"|",{"type":24,"tag":103,"props":516,"children":517},{"style":116},[518],{"type":29,"value":519},"perf: f64",{"type":24,"tag":103,"props":521,"children":522},{"style":110},[523],{"type":29,"value":514},{"type":24,"tag":103,"props":525,"children":526},{"style":116},[527],{"type":29,"value":528}," {\n",{"type":24,"tag":103,"props":530,"children":531},{"class":105,"line":251},[532,537,541,546,551,556,561,566,571,575,580],{"type":24,"tag":103,"props":533,"children":534},{"style":116},[535],{"type":29,"value":536},"        let _",{"type":24,"tag":103,"props":538,"children":539},{"style":110},[540],{"type":29,"value":271},{"type":24,"tag":103,"props":542,"children":543},{"style":116},[544],{"type":29,"value":545}," browser::",{"type":24,"tag":103,"props":547,"children":548},{"style":211},[549],{"type":29,"value":550},"request_animation_frame",{"type":24,"tag":103,"props":552,"children":553},{"style":116},[554],{"type":29,"value":555},"(f.",{"type":24,"tag":103,"props":557,"children":558},{"style":211},[559],{"type":29,"value":560},"borrow",{"type":24,"tag":103,"props":562,"children":563},{"style":116},[564],{"type":29,"value":565},"().",{"type":24,"tag":103,"props":567,"children":568},{"style":211},[569],{"type":29,"value":570},"as_ref",{"type":24,"tag":103,"props":572,"children":573},{"style":116},[574],{"type":29,"value":565},{"type":24,"tag":103,"props":576,"children":577},{"style":211},[578],{"type":29,"value":579},"unwrap",{"type":24,"tag":103,"props":581,"children":582},{"style":116},[583],{"type":29,"value":584},"());\n",{"type":24,"tag":103,"props":586,"children":587},{"class":105,"line":260},[588],{"type":24,"tag":103,"props":589,"children":590},{"style":116},[591],{"type":29,"value":592},"    }));\n",{"type":24,"tag":103,"props":594,"children":595},{"class":105,"line":279},[596,601,605],{"type":24,"tag":103,"props":597,"children":598},{"style":116},[599],{"type":29,"value":600},"    browser::",{"type":24,"tag":103,"props":602,"children":603},{"style":211},[604],{"type":29,"value":550},{"type":24,"tag":103,"props":606,"children":607},{"style":116},[608],{"type":29,"value":609},"(\n",{"type":24,"tag":103,"props":611,"children":613},{"class":105,"line":612},9,[614,619,623],{"type":24,"tag":103,"props":615,"children":616},{"style":116},[617],{"type":29,"value":618},"        g.",{"type":24,"tag":103,"props":620,"children":621},{"style":211},[622],{"type":29,"value":560},{"type":24,"tag":103,"props":624,"children":625},{"style":116},[626],{"type":29,"value":627},"()\n",{"type":24,"tag":103,"props":629,"children":631},{"class":105,"line":630},10,[632,637,641],{"type":24,"tag":103,"props":633,"children":634},{"style":116},[635],{"type":29,"value":636},"            .",{"type":24,"tag":103,"props":638,"children":639},{"style":211},[640],{"type":29,"value":570},{"type":24,"tag":103,"props":642,"children":643},{"style":116},[644],{"type":29,"value":627},{"type":24,"tag":103,"props":646,"children":648},{"class":105,"line":647},11,[649,653,658,662,667,672,677,681,687,693,697,702,707],{"type":24,"tag":103,"props":650,"children":651},{"style":116},[652],{"type":29,"value":636},{"type":24,"tag":103,"props":654,"children":655},{"style":211},[656],{"type":29,"value":657},"ok_or_else",{"type":24,"tag":103,"props":659,"children":660},{"style":116},[661],{"type":29,"value":219},{"type":24,"tag":103,"props":663,"children":664},{"style":110},[665],{"type":29,"value":666},"||",{"type":24,"tag":103,"props":668,"children":669},{"style":211},[670],{"type":29,"value":671}," anyhow",{"type":24,"tag":103,"props":673,"children":674},{"style":110},[675],{"type":29,"value":676},"!",{"type":24,"tag":103,"props":678,"children":679},{"style":116},[680],{"type":29,"value":219},{"type":24,"tag":103,"props":682,"children":684},{"style":683},"--shiki-default:#E9F284",[685],{"type":29,"value":686},"\"",{"type":24,"tag":103,"props":688,"children":690},{"style":689},"--shiki-default:#F1FA8C",[691],{"type":29,"value":692},"GameLoop: Loop is None",{"type":24,"tag":103,"props":694,"children":695},{"style":683},[696],{"type":29,"value":686},{"type":24,"tag":103,"props":698,"children":699},{"style":116},[700],{"type":29,"value":701},"))",{"type":24,"tag":103,"props":703,"children":704},{"style":110},[705],{"type":29,"value":706},"?",{"type":24,"tag":103,"props":708,"children":709},{"style":116},[710],{"type":29,"value":711},",\n",{"type":24,"tag":103,"props":713,"children":715},{"class":105,"line":714},12,[716,721,725],{"type":24,"tag":103,"props":717,"children":718},{"style":116},[719],{"type":29,"value":720},"    )",{"type":24,"tag":103,"props":722,"children":723},{"style":110},[724],{"type":29,"value":706},{"type":24,"tag":103,"props":726,"children":727},{"style":116},[728],{"type":29,"value":166},{"type":24,"tag":103,"props":730,"children":732},{"class":105,"line":731},13,[733,738],{"type":24,"tag":103,"props":734,"children":735},{"style":211},[736],{"type":29,"value":737},"    Ok",{"type":24,"tag":103,"props":739,"children":740},{"style":116},[741],{"type":29,"value":742},"(())\n",{"type":24,"tag":103,"props":744,"children":746},{"class":105,"line":745},14,[747],{"type":24,"tag":103,"props":748,"children":749},{"style":116},[750],{"type":29,"value":257},{"type":24,"tag":32,"props":752,"children":754},{"id":753},"it-was-a-fun-experience-to-code-a-game",[755],{"type":29,"value":756},"It was a fun experience to code a game",{"type":24,"tag":25,"props":758,"children":759},{},[760],{"type":29,"value":761},"Forty years ago, my first personal computer was an MSX2. I enjoyed programming by typing in the source code published in BASIC Magazine. The first program I typed was a racing game similar to the one I've created recently. Though my memory is a bit hazy, I recall the walls being represented by \"#\" and the car by a diamond character \"♢\". I remember spending hours correcting typos while referencing the magazine's source code. The joy I felt when the copied program finally ran is something I'll never forget. The excitement of seeing a program come to life hasn't changed at all, even now.",{"type":24,"tag":763,"props":764,"children":765},"style",{},[766],{"type":29,"value":767},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":8,"searchDepth":169,"depth":169,"links":769},[770,771,772],{"id":34,"depth":178,"text":37},{"id":77,"depth":178,"text":80},{"id":753,"depth":178,"text":756},"markdown","content:blogs:1. fetch-content-data-render-pages.md","content","blogs/1. fetch-content-data-render-pages.md","blogs/1. fetch-content-data-render-pages","md",{"loc":5},1729518063516]