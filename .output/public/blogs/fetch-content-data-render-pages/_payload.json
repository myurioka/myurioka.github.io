[{"data":1,"prerenderedAt":779},["ShallowReactive",2],{"blog-post-/blogs/fetch-content-data-render-pages":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"date":10,"image":11,"alt":12,"ogImage":13,"tags":14,"published":18,"body":19,"_type":772,"_id":773,"_source":774,"_file":775,"_stem":776,"_extension":777,"sitemap":778},"/blogs/fetch-content-data-render-pages","blogs",false,"","Game Loop in Rust & Wasm",null,"20th Oct 2024","/blogs-img/20241013.png","You can't make a game without a game loop.","/blogs-img/blog4.jpg",[15,16,17],"rust","wasm","webassembly",true,{"type":20,"children":21,"toc":767},"root",[22,30,37,42,47,59,64,74,80,90,303,313,321,750,756,761],{"type":23,"tag":24,"props":25,"children":26},"element","p",{},[27],{"type":28,"value":29},"text","I find understandig the game loop really engoyable.",{"type":23,"tag":31,"props":32,"children":34},"h3",{"id":33},"introduction",[35],{"type":28,"value":36},"Introduction",{"type":23,"tag":24,"props":38,"children":39},{},[40],{"type":28,"value":41},"In the programming I usually do, a game loop is not necessary.\nHowever, it is necessary when programing games.",{"type":23,"tag":24,"props":43,"children":44},{},[45],{"type":28,"value":46},"I'm going to share some insights from my experience implementing a game loop with Rust and WASM.",{"type":23,"tag":24,"props":48,"children":49},{},[50],{"type":23,"tag":51,"props":52,"children":56},"a",{"href":53,"rel":54},"https://github.com/myurioka/cart",[55],"nofollow",[57],{"type":28,"value":58},"cart / Programing Retro Game in Rust & Wasm in Github",{"type":23,"tag":24,"props":60,"children":61},{},[62],{"type":28,"value":63},"Here are the websites I referred to when coding the game loop.",{"type":23,"tag":24,"props":65,"children":66},{},[67],{"type":23,"tag":51,"props":68,"children":71},{"href":69,"rel":70},"https://github.com/PacktPublishing/Game-Development-with-Rust-and-WebAssembly",[55],[72],{"type":28,"value":73},"Game-Development-with-Rust-and-WebAssembly",{"type":23,"tag":31,"props":75,"children":77},{"id":76},"what-i-enjoyed-most-about-programing-a-game-loop",[78],{"type":28,"value":79},"What I enjoyed most about programing a game loop",{"type":23,"tag":81,"props":82,"children":83},"ul",{},[84],{"type":23,"tag":85,"props":86,"children":87},"li",{},[88],{"type":28,"value":89},"The code has implemented a sophisticated technique to synchronize rendering with the browser's actual frame rate.",{"type":23,"tag":91,"props":92,"children":96},"pre",{"className":93,"code":94,"language":95,"meta":7,"style":7},"language-js shiki shiki-themes dracula","const FRAME_SIZE: f64 = 1.0 / 60.0 * 1000.0;\n\nwhile game_loop.accumulated_delta > FRAME_SIZE {\n    game.update(&keystate);\n    game_loop.accumulated_delta -= FRAME_SIZE;\n}\ngame_loop.last_frame = perf;\ngame.draw(&renderer);\n","js",[97],{"type":23,"tag":98,"props":99,"children":100},"code",{"__ignoreMap":7},[101,166,175,199,229,248,257,276],{"type":23,"tag":102,"props":103,"children":106},"span",{"class":104,"line":105},"line",1,[107,113,119,124,130,135,141,146,151,156,161],{"type":23,"tag":102,"props":108,"children":110},{"style":109},"--shiki-default:#FF79C6",[111],{"type":28,"value":112},"const",{"type":23,"tag":102,"props":114,"children":116},{"style":115},"--shiki-default:#F8F8F2",[117],{"type":28,"value":118}," FRAME_SIZE",{"type":23,"tag":102,"props":120,"children":121},{"style":109},[122],{"type":28,"value":123},":",{"type":23,"tag":102,"props":125,"children":127},{"style":126},"--shiki-default:#8BE9FD;--shiki-default-font-style:italic",[128],{"type":28,"value":129}," f64",{"type":23,"tag":102,"props":131,"children":132},{"style":109},[133],{"type":28,"value":134}," =",{"type":23,"tag":102,"props":136,"children":138},{"style":137},"--shiki-default:#BD93F9",[139],{"type":28,"value":140}," 1.0",{"type":23,"tag":102,"props":142,"children":143},{"style":109},[144],{"type":28,"value":145}," /",{"type":23,"tag":102,"props":147,"children":148},{"style":137},[149],{"type":28,"value":150}," 60.0",{"type":23,"tag":102,"props":152,"children":153},{"style":109},[154],{"type":28,"value":155}," *",{"type":23,"tag":102,"props":157,"children":158},{"style":137},[159],{"type":28,"value":160}," 1000.0",{"type":23,"tag":102,"props":162,"children":163},{"style":115},[164],{"type":28,"value":165},";\n",{"type":23,"tag":102,"props":167,"children":169},{"class":104,"line":168},2,[170],{"type":23,"tag":102,"props":171,"children":172},{"emptyLinePlaceholder":18},[173],{"type":28,"value":174},"\n",{"type":23,"tag":102,"props":176,"children":178},{"class":104,"line":177},3,[179,184,189,194],{"type":23,"tag":102,"props":180,"children":181},{"style":109},[182],{"type":28,"value":183},"while",{"type":23,"tag":102,"props":185,"children":186},{"style":115},[187],{"type":28,"value":188}," game_loop.accumulated_delta ",{"type":23,"tag":102,"props":190,"children":191},{"style":109},[192],{"type":28,"value":193},">",{"type":23,"tag":102,"props":195,"children":196},{"style":115},[197],{"type":28,"value":198}," FRAME_SIZE {\n",{"type":23,"tag":102,"props":200,"children":202},{"class":104,"line":201},4,[203,208,214,219,224],{"type":23,"tag":102,"props":204,"children":205},{"style":115},[206],{"type":28,"value":207},"    game.",{"type":23,"tag":102,"props":209,"children":211},{"style":210},"--shiki-default:#50FA7B",[212],{"type":28,"value":213},"update",{"type":23,"tag":102,"props":215,"children":216},{"style":115},[217],{"type":28,"value":218},"(",{"type":23,"tag":102,"props":220,"children":221},{"style":109},[222],{"type":28,"value":223},"&",{"type":23,"tag":102,"props":225,"children":226},{"style":115},[227],{"type":28,"value":228},"keystate);\n",{"type":23,"tag":102,"props":230,"children":232},{"class":104,"line":231},5,[233,238,243],{"type":23,"tag":102,"props":234,"children":235},{"style":115},[236],{"type":28,"value":237},"    game_loop.accumulated_delta ",{"type":23,"tag":102,"props":239,"children":240},{"style":109},[241],{"type":28,"value":242},"-=",{"type":23,"tag":102,"props":244,"children":245},{"style":115},[246],{"type":28,"value":247}," FRAME_SIZE;\n",{"type":23,"tag":102,"props":249,"children":251},{"class":104,"line":250},6,[252],{"type":23,"tag":102,"props":253,"children":254},{"style":115},[255],{"type":28,"value":256},"}\n",{"type":23,"tag":102,"props":258,"children":260},{"class":104,"line":259},7,[261,266,271],{"type":23,"tag":102,"props":262,"children":263},{"style":115},[264],{"type":28,"value":265},"game_loop.last_frame ",{"type":23,"tag":102,"props":267,"children":268},{"style":109},[269],{"type":28,"value":270},"=",{"type":23,"tag":102,"props":272,"children":273},{"style":115},[274],{"type":28,"value":275}," perf;\n",{"type":23,"tag":102,"props":277,"children":279},{"class":104,"line":278},8,[280,285,290,294,298],{"type":23,"tag":102,"props":281,"children":282},{"style":115},[283],{"type":28,"value":284},"game.",{"type":23,"tag":102,"props":286,"children":287},{"style":210},[288],{"type":28,"value":289},"draw",{"type":23,"tag":102,"props":291,"children":292},{"style":115},[293],{"type":28,"value":218},{"type":23,"tag":102,"props":295,"children":296},{"style":109},[297],{"type":28,"value":223},{"type":23,"tag":102,"props":299,"children":300},{"style":115},[301],{"type":28,"value":302},"renderer);\n",{"type":23,"tag":24,"props":304,"children":305},{},[306],{"type":23,"tag":51,"props":307,"children":310},{"href":308,"rel":309},"https://developer.mozilla.org/en-US/docs/Glossary/FPS",[55],[311],{"type":28,"value":312},"Browser Frame rate(FPS)",{"type":23,"tag":81,"props":314,"children":315},{},[316],{"type":23,"tag":85,"props":317,"children":318},{},[319],{"type":28,"value":320},"Rust ownership, particularly the concept of borrowing and lifetimes, is crucial for understanding this implementation.",{"type":23,"tag":91,"props":322,"children":324},{"className":93,"code":323,"language":95,"meta":7,"style":7},"impl GameLoop {\n    let f: SharedLoopClosure = Rc::new(RefCell::new(None));\n    let g = f.clone();\n    let mut keystate = KeyState::new();\n    *g.borrow_mut() = Some(browser::create_raf_closure(move |perf: f64| {\n        let _= browser::request_animation_frame(f.borrow().as_ref().unwrap());\n    }));\n    browser::request_animation_frame(\n        g.borrow()\n            .as_ref()\n            .ok_or_else(|| anyhow!(\"GameLoop: Loop is None\"))?,\n    )?;\n    Ok(())\n}\n",[325],{"type":23,"tag":98,"props":326,"children":327},{"__ignoreMap":7},[328,336,406,433,462,528,584,592,609,627,644,711,728,742],{"type":23,"tag":102,"props":329,"children":330},{"class":104,"line":105},[331],{"type":23,"tag":102,"props":332,"children":333},{"style":115},[334],{"type":28,"value":335},"impl GameLoop {\n",{"type":23,"tag":102,"props":337,"children":338},{"class":104,"line":168},[339,344,349,353,358,362,367,373,377,383,388,392,396,401],{"type":23,"tag":102,"props":340,"children":341},{"style":109},[342],{"type":28,"value":343},"    let",{"type":23,"tag":102,"props":345,"children":346},{"style":115},[347],{"type":28,"value":348}," f",{"type":23,"tag":102,"props":350,"children":351},{"style":109},[352],{"type":28,"value":123},{"type":23,"tag":102,"props":354,"children":355},{"style":126},[356],{"type":28,"value":357}," SharedLoopClosure",{"type":23,"tag":102,"props":359,"children":360},{"style":109},[361],{"type":28,"value":134},{"type":23,"tag":102,"props":363,"children":364},{"style":115},[365],{"type":28,"value":366}," Rc::",{"type":23,"tag":102,"props":368,"children":370},{"style":369},"--shiki-default:#FF79C6;--shiki-default-font-weight:bold",[371],{"type":28,"value":372},"new",{"type":23,"tag":102,"props":374,"children":375},{"style":115},[376],{"type":28,"value":218},{"type":23,"tag":102,"props":378,"children":380},{"style":379},"--shiki-default:#FFB86C;--shiki-default-font-style:italic",[381],{"type":28,"value":382},"RefCell",{"type":23,"tag":102,"props":384,"children":385},{"style":109},[386],{"type":28,"value":387},"::",{"type":23,"tag":102,"props":389,"children":390},{"style":369},[391],{"type":28,"value":372},{"type":23,"tag":102,"props":393,"children":394},{"style":115},[395],{"type":28,"value":218},{"type":23,"tag":102,"props":397,"children":398},{"style":379},[399],{"type":28,"value":400},"None",{"type":23,"tag":102,"props":402,"children":403},{"style":115},[404],{"type":28,"value":405},"));\n",{"type":23,"tag":102,"props":407,"children":408},{"class":104,"line":177},[409,414,418,423,428],{"type":23,"tag":102,"props":410,"children":411},{"style":115},[412],{"type":28,"value":413},"    let g ",{"type":23,"tag":102,"props":415,"children":416},{"style":109},[417],{"type":28,"value":270},{"type":23,"tag":102,"props":419,"children":420},{"style":115},[421],{"type":28,"value":422}," f.",{"type":23,"tag":102,"props":424,"children":425},{"style":210},[426],{"type":28,"value":427},"clone",{"type":23,"tag":102,"props":429,"children":430},{"style":115},[431],{"type":28,"value":432},"();\n",{"type":23,"tag":102,"props":434,"children":435},{"class":104,"line":201},[436,440,445,449,454,458],{"type":23,"tag":102,"props":437,"children":438},{"style":109},[439],{"type":28,"value":343},{"type":23,"tag":102,"props":441,"children":442},{"style":115},[443],{"type":28,"value":444}," mut keystate ",{"type":23,"tag":102,"props":446,"children":447},{"style":109},[448],{"type":28,"value":270},{"type":23,"tag":102,"props":450,"children":451},{"style":115},[452],{"type":28,"value":453}," KeyState::",{"type":23,"tag":102,"props":455,"children":456},{"style":369},[457],{"type":28,"value":372},{"type":23,"tag":102,"props":459,"children":460},{"style":115},[461],{"type":28,"value":432},{"type":23,"tag":102,"props":463,"children":464},{"class":104,"line":231},[465,470,475,480,485,489,494,499,504,509,514,519,523],{"type":23,"tag":102,"props":466,"children":467},{"style":109},[468],{"type":28,"value":469},"    *",{"type":23,"tag":102,"props":471,"children":472},{"style":115},[473],{"type":28,"value":474},"g.",{"type":23,"tag":102,"props":476,"children":477},{"style":210},[478],{"type":28,"value":479},"borrow_mut",{"type":23,"tag":102,"props":481,"children":482},{"style":115},[483],{"type":28,"value":484},"() ",{"type":23,"tag":102,"props":486,"children":487},{"style":109},[488],{"type":28,"value":270},{"type":23,"tag":102,"props":490,"children":491},{"style":210},[492],{"type":28,"value":493}," Some",{"type":23,"tag":102,"props":495,"children":496},{"style":115},[497],{"type":28,"value":498},"(browser::",{"type":23,"tag":102,"props":500,"children":501},{"style":210},[502],{"type":28,"value":503},"create_raf_closure",{"type":23,"tag":102,"props":505,"children":506},{"style":115},[507],{"type":28,"value":508},"(move ",{"type":23,"tag":102,"props":510,"children":511},{"style":109},[512],{"type":28,"value":513},"|",{"type":23,"tag":102,"props":515,"children":516},{"style":115},[517],{"type":28,"value":518},"perf: f64",{"type":23,"tag":102,"props":520,"children":521},{"style":109},[522],{"type":28,"value":513},{"type":23,"tag":102,"props":524,"children":525},{"style":115},[526],{"type":28,"value":527}," {\n",{"type":23,"tag":102,"props":529,"children":530},{"class":104,"line":250},[531,536,540,545,550,555,560,565,570,574,579],{"type":23,"tag":102,"props":532,"children":533},{"style":115},[534],{"type":28,"value":535},"        let _",{"type":23,"tag":102,"props":537,"children":538},{"style":109},[539],{"type":28,"value":270},{"type":23,"tag":102,"props":541,"children":542},{"style":115},[543],{"type":28,"value":544}," browser::",{"type":23,"tag":102,"props":546,"children":547},{"style":210},[548],{"type":28,"value":549},"request_animation_frame",{"type":23,"tag":102,"props":551,"children":552},{"style":115},[553],{"type":28,"value":554},"(f.",{"type":23,"tag":102,"props":556,"children":557},{"style":210},[558],{"type":28,"value":559},"borrow",{"type":23,"tag":102,"props":561,"children":562},{"style":115},[563],{"type":28,"value":564},"().",{"type":23,"tag":102,"props":566,"children":567},{"style":210},[568],{"type":28,"value":569},"as_ref",{"type":23,"tag":102,"props":571,"children":572},{"style":115},[573],{"type":28,"value":564},{"type":23,"tag":102,"props":575,"children":576},{"style":210},[577],{"type":28,"value":578},"unwrap",{"type":23,"tag":102,"props":580,"children":581},{"style":115},[582],{"type":28,"value":583},"());\n",{"type":23,"tag":102,"props":585,"children":586},{"class":104,"line":259},[587],{"type":23,"tag":102,"props":588,"children":589},{"style":115},[590],{"type":28,"value":591},"    }));\n",{"type":23,"tag":102,"props":593,"children":594},{"class":104,"line":278},[595,600,604],{"type":23,"tag":102,"props":596,"children":597},{"style":115},[598],{"type":28,"value":599},"    browser::",{"type":23,"tag":102,"props":601,"children":602},{"style":210},[603],{"type":28,"value":549},{"type":23,"tag":102,"props":605,"children":606},{"style":115},[607],{"type":28,"value":608},"(\n",{"type":23,"tag":102,"props":610,"children":612},{"class":104,"line":611},9,[613,618,622],{"type":23,"tag":102,"props":614,"children":615},{"style":115},[616],{"type":28,"value":617},"        g.",{"type":23,"tag":102,"props":619,"children":620},{"style":210},[621],{"type":28,"value":559},{"type":23,"tag":102,"props":623,"children":624},{"style":115},[625],{"type":28,"value":626},"()\n",{"type":23,"tag":102,"props":628,"children":630},{"class":104,"line":629},10,[631,636,640],{"type":23,"tag":102,"props":632,"children":633},{"style":115},[634],{"type":28,"value":635},"            .",{"type":23,"tag":102,"props":637,"children":638},{"style":210},[639],{"type":28,"value":569},{"type":23,"tag":102,"props":641,"children":642},{"style":115},[643],{"type":28,"value":626},{"type":23,"tag":102,"props":645,"children":647},{"class":104,"line":646},11,[648,652,657,661,666,671,676,680,686,692,696,701,706],{"type":23,"tag":102,"props":649,"children":650},{"style":115},[651],{"type":28,"value":635},{"type":23,"tag":102,"props":653,"children":654},{"style":210},[655],{"type":28,"value":656},"ok_or_else",{"type":23,"tag":102,"props":658,"children":659},{"style":115},[660],{"type":28,"value":218},{"type":23,"tag":102,"props":662,"children":663},{"style":109},[664],{"type":28,"value":665},"||",{"type":23,"tag":102,"props":667,"children":668},{"style":210},[669],{"type":28,"value":670}," anyhow",{"type":23,"tag":102,"props":672,"children":673},{"style":109},[674],{"type":28,"value":675},"!",{"type":23,"tag":102,"props":677,"children":678},{"style":115},[679],{"type":28,"value":218},{"type":23,"tag":102,"props":681,"children":683},{"style":682},"--shiki-default:#E9F284",[684],{"type":28,"value":685},"\"",{"type":23,"tag":102,"props":687,"children":689},{"style":688},"--shiki-default:#F1FA8C",[690],{"type":28,"value":691},"GameLoop: Loop is None",{"type":23,"tag":102,"props":693,"children":694},{"style":682},[695],{"type":28,"value":685},{"type":23,"tag":102,"props":697,"children":698},{"style":115},[699],{"type":28,"value":700},"))",{"type":23,"tag":102,"props":702,"children":703},{"style":109},[704],{"type":28,"value":705},"?",{"type":23,"tag":102,"props":707,"children":708},{"style":115},[709],{"type":28,"value":710},",\n",{"type":23,"tag":102,"props":712,"children":714},{"class":104,"line":713},12,[715,720,724],{"type":23,"tag":102,"props":716,"children":717},{"style":115},[718],{"type":28,"value":719},"    )",{"type":23,"tag":102,"props":721,"children":722},{"style":109},[723],{"type":28,"value":705},{"type":23,"tag":102,"props":725,"children":726},{"style":115},[727],{"type":28,"value":165},{"type":23,"tag":102,"props":729,"children":731},{"class":104,"line":730},13,[732,737],{"type":23,"tag":102,"props":733,"children":734},{"style":210},[735],{"type":28,"value":736},"    Ok",{"type":23,"tag":102,"props":738,"children":739},{"style":115},[740],{"type":28,"value":741},"(())\n",{"type":23,"tag":102,"props":743,"children":745},{"class":104,"line":744},14,[746],{"type":23,"tag":102,"props":747,"children":748},{"style":115},[749],{"type":28,"value":256},{"type":23,"tag":31,"props":751,"children":753},{"id":752},"it-was-a-fun-experience-to-code-a-game",[754],{"type":28,"value":755},"It was a fun experience to code a game",{"type":23,"tag":24,"props":757,"children":758},{},[759],{"type":28,"value":760},"Forty years ago, my first personal computer was an MSX2. I enjoyed programming by typing in the source code published in BASIC Magazine. The first program I typed was a racing game similar to the one I've created recently. Though my memory is a bit hazy, I recall the walls being represented by \"#\" and the car by a diamond character \"♢\". I remember spending hours correcting typos while referencing the magazine's source code. The joy I felt when the copied program finally ran is something I'll never forget. The excitement of seeing a program come to life hasn't changed at all, even now.",{"type":23,"tag":762,"props":763,"children":764},"style",{},[765],{"type":28,"value":766},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":7,"searchDepth":168,"depth":168,"links":768},[769,770,771],{"id":33,"depth":177,"text":36},{"id":76,"depth":177,"text":79},{"id":752,"depth":177,"text":755},"markdown","content:blogs:1. fetch-content-data-render-pages.md","content","blogs/1. fetch-content-data-render-pages.md","blogs/1. fetch-content-data-render-pages","md",{"loc":4},1729435172453]