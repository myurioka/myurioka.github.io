[{"data":1,"prerenderedAt":799},["ShallowReactive",2],{"blog-post-/blogs/cart":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"date":10,"image":11,"alt":12,"ogImage":13,"tags":14,"published":18,"body":19,"_type":792,"_id":793,"_source":794,"_file":795,"_stem":796,"_extension":797,"sitemap":798},"/blogs/cart","blogs",false,"","Game Loop in Rust & Wasm",null,"20th Oct 2024","/blogs-img/20241013.png","You can't make a game without a game loop.","/blogs-img/blog4.jpg",[15,16,17],"rust","wasm","webassembly",true,{"type":20,"children":21,"toc":787},"root",[22,30,37,42,47,64,79,84,94,100,110,323,333,341,770,776,781],{"type":23,"tag":24,"props":25,"children":26},"element","p",{},[27],{"type":28,"value":29},"text","I find understandig the game loop really engoyable.",{"type":23,"tag":31,"props":32,"children":34},"h3",{"id":33},"introduction",[35],{"type":28,"value":36},"Introduction",{"type":23,"tag":24,"props":38,"children":39},{},[40],{"type":28,"value":41},"In the programming I usually do, a game loop is not necessary.\nHowever, it is necessary when programing games.",{"type":23,"tag":24,"props":43,"children":44},{},[45],{"type":28,"value":46},"I'm going to share some insights from my experience implementing a game loop with Rust and WASM.",{"type":23,"tag":24,"props":48,"children":49},{},[50,59],{"type":23,"tag":51,"props":52,"children":56},"a",{"href":53,"rel":54},"https://myurioka.github.io/cart/",[55],"nofollow",[57],{"type":28,"value":58},"Cart / Mini Game Play in browser",{"type":23,"tag":51,"props":60,"children":62},{"href":53,"rel":61},[55],[63],{"type":28,"value":53},{"type":23,"tag":24,"props":65,"children":66},{},[67,74],{"type":23,"tag":51,"props":68,"children":71},{"href":69,"rel":70},"https://github.com/myurioka/cart",[55],[72],{"type":28,"value":73},"cart / Programing Retro Game in Rust & Wasm in Github",{"type":23,"tag":51,"props":75,"children":77},{"href":69,"rel":76},[55],[78],{"type":28,"value":69},{"type":23,"tag":24,"props":80,"children":81},{},[82],{"type":28,"value":83},"Here are the websites I referred to when coding the game loop.",{"type":23,"tag":24,"props":85,"children":86},{},[87],{"type":23,"tag":51,"props":88,"children":91},{"href":89,"rel":90},"https://github.com/PacktPublishing/Game-Development-with-Rust-and-WebAssembly",[55],[92],{"type":28,"value":93},"Game-Development-with-Rust-and-WebAssembly",{"type":23,"tag":31,"props":95,"children":97},{"id":96},"what-i-enjoyed-most-about-programing-a-game-loop",[98],{"type":28,"value":99},"What I enjoyed most about programing a game loop",{"type":23,"tag":101,"props":102,"children":103},"ul",{},[104],{"type":23,"tag":105,"props":106,"children":107},"li",{},[108],{"type":28,"value":109},"The code has implemented a sophisticated technique to synchronize rendering with the browser's actual frame rate.",{"type":23,"tag":111,"props":112,"children":116},"pre",{"className":113,"code":114,"language":115,"meta":7,"style":7},"language-js shiki shiki-themes dracula","const FRAME_SIZE: f64 = 1.0 / 60.0 * 1000.0;\n\nwhile game_loop.accumulated_delta > FRAME_SIZE {\n    game.update(&keystate);\n    game_loop.accumulated_delta -= FRAME_SIZE;\n}\ngame_loop.last_frame = perf;\ngame.draw(&renderer);\n","js",[117],{"type":23,"tag":118,"props":119,"children":120},"code",{"__ignoreMap":7},[121,186,195,219,249,268,277,296],{"type":23,"tag":122,"props":123,"children":126},"span",{"class":124,"line":125},"line",1,[127,133,139,144,150,155,161,166,171,176,181],{"type":23,"tag":122,"props":128,"children":130},{"style":129},"--shiki-default:#FF79C6",[131],{"type":28,"value":132},"const",{"type":23,"tag":122,"props":134,"children":136},{"style":135},"--shiki-default:#F8F8F2",[137],{"type":28,"value":138}," FRAME_SIZE",{"type":23,"tag":122,"props":140,"children":141},{"style":129},[142],{"type":28,"value":143},":",{"type":23,"tag":122,"props":145,"children":147},{"style":146},"--shiki-default:#8BE9FD;--shiki-default-font-style:italic",[148],{"type":28,"value":149}," f64",{"type":23,"tag":122,"props":151,"children":152},{"style":129},[153],{"type":28,"value":154}," =",{"type":23,"tag":122,"props":156,"children":158},{"style":157},"--shiki-default:#BD93F9",[159],{"type":28,"value":160}," 1.0",{"type":23,"tag":122,"props":162,"children":163},{"style":129},[164],{"type":28,"value":165}," /",{"type":23,"tag":122,"props":167,"children":168},{"style":157},[169],{"type":28,"value":170}," 60.0",{"type":23,"tag":122,"props":172,"children":173},{"style":129},[174],{"type":28,"value":175}," *",{"type":23,"tag":122,"props":177,"children":178},{"style":157},[179],{"type":28,"value":180}," 1000.0",{"type":23,"tag":122,"props":182,"children":183},{"style":135},[184],{"type":28,"value":185},";\n",{"type":23,"tag":122,"props":187,"children":189},{"class":124,"line":188},2,[190],{"type":23,"tag":122,"props":191,"children":192},{"emptyLinePlaceholder":18},[193],{"type":28,"value":194},"\n",{"type":23,"tag":122,"props":196,"children":198},{"class":124,"line":197},3,[199,204,209,214],{"type":23,"tag":122,"props":200,"children":201},{"style":129},[202],{"type":28,"value":203},"while",{"type":23,"tag":122,"props":205,"children":206},{"style":135},[207],{"type":28,"value":208}," game_loop.accumulated_delta ",{"type":23,"tag":122,"props":210,"children":211},{"style":129},[212],{"type":28,"value":213},">",{"type":23,"tag":122,"props":215,"children":216},{"style":135},[217],{"type":28,"value":218}," FRAME_SIZE {\n",{"type":23,"tag":122,"props":220,"children":222},{"class":124,"line":221},4,[223,228,234,239,244],{"type":23,"tag":122,"props":224,"children":225},{"style":135},[226],{"type":28,"value":227},"    game.",{"type":23,"tag":122,"props":229,"children":231},{"style":230},"--shiki-default:#50FA7B",[232],{"type":28,"value":233},"update",{"type":23,"tag":122,"props":235,"children":236},{"style":135},[237],{"type":28,"value":238},"(",{"type":23,"tag":122,"props":240,"children":241},{"style":129},[242],{"type":28,"value":243},"&",{"type":23,"tag":122,"props":245,"children":246},{"style":135},[247],{"type":28,"value":248},"keystate);\n",{"type":23,"tag":122,"props":250,"children":252},{"class":124,"line":251},5,[253,258,263],{"type":23,"tag":122,"props":254,"children":255},{"style":135},[256],{"type":28,"value":257},"    game_loop.accumulated_delta ",{"type":23,"tag":122,"props":259,"children":260},{"style":129},[261],{"type":28,"value":262},"-=",{"type":23,"tag":122,"props":264,"children":265},{"style":135},[266],{"type":28,"value":267}," FRAME_SIZE;\n",{"type":23,"tag":122,"props":269,"children":271},{"class":124,"line":270},6,[272],{"type":23,"tag":122,"props":273,"children":274},{"style":135},[275],{"type":28,"value":276},"}\n",{"type":23,"tag":122,"props":278,"children":280},{"class":124,"line":279},7,[281,286,291],{"type":23,"tag":122,"props":282,"children":283},{"style":135},[284],{"type":28,"value":285},"game_loop.last_frame ",{"type":23,"tag":122,"props":287,"children":288},{"style":129},[289],{"type":28,"value":290},"=",{"type":23,"tag":122,"props":292,"children":293},{"style":135},[294],{"type":28,"value":295}," perf;\n",{"type":23,"tag":122,"props":297,"children":299},{"class":124,"line":298},8,[300,305,310,314,318],{"type":23,"tag":122,"props":301,"children":302},{"style":135},[303],{"type":28,"value":304},"game.",{"type":23,"tag":122,"props":306,"children":307},{"style":230},[308],{"type":28,"value":309},"draw",{"type":23,"tag":122,"props":311,"children":312},{"style":135},[313],{"type":28,"value":238},{"type":23,"tag":122,"props":315,"children":316},{"style":129},[317],{"type":28,"value":243},{"type":23,"tag":122,"props":319,"children":320},{"style":135},[321],{"type":28,"value":322},"renderer);\n",{"type":23,"tag":24,"props":324,"children":325},{},[326],{"type":23,"tag":51,"props":327,"children":330},{"href":328,"rel":329},"https://developer.mozilla.org/en-US/docs/Glossary/FPS",[55],[331],{"type":28,"value":332},"Browser Frame rate(FPS)",{"type":23,"tag":101,"props":334,"children":335},{},[336],{"type":23,"tag":105,"props":337,"children":338},{},[339],{"type":28,"value":340},"Rust ownership, particularly the concept of borrowing and lifetimes, is crucial for understanding this implementation.",{"type":23,"tag":111,"props":342,"children":344},{"className":113,"code":343,"language":115,"meta":7,"style":7},"impl GameLoop {\n    let f: SharedLoopClosure = Rc::new(RefCell::new(None));\n    let g = f.clone();\n    let mut keystate = KeyState::new();\n    *g.borrow_mut() = Some(browser::create_raf_closure(move |perf: f64| {\n        let _= browser::request_animation_frame(f.borrow().as_ref().unwrap());\n    }));\n    browser::request_animation_frame(\n        g.borrow()\n            .as_ref()\n            .ok_or_else(|| anyhow!(\"GameLoop: Loop is None\"))?,\n    )?;\n    Ok(())\n}\n",[345],{"type":23,"tag":118,"props":346,"children":347},{"__ignoreMap":7},[348,356,426,453,482,548,604,612,629,647,664,731,748,762],{"type":23,"tag":122,"props":349,"children":350},{"class":124,"line":125},[351],{"type":23,"tag":122,"props":352,"children":353},{"style":135},[354],{"type":28,"value":355},"impl GameLoop {\n",{"type":23,"tag":122,"props":357,"children":358},{"class":124,"line":188},[359,364,369,373,378,382,387,393,397,403,408,412,416,421],{"type":23,"tag":122,"props":360,"children":361},{"style":129},[362],{"type":28,"value":363},"    let",{"type":23,"tag":122,"props":365,"children":366},{"style":135},[367],{"type":28,"value":368}," f",{"type":23,"tag":122,"props":370,"children":371},{"style":129},[372],{"type":28,"value":143},{"type":23,"tag":122,"props":374,"children":375},{"style":146},[376],{"type":28,"value":377}," SharedLoopClosure",{"type":23,"tag":122,"props":379,"children":380},{"style":129},[381],{"type":28,"value":154},{"type":23,"tag":122,"props":383,"children":384},{"style":135},[385],{"type":28,"value":386}," Rc::",{"type":23,"tag":122,"props":388,"children":390},{"style":389},"--shiki-default:#FF79C6;--shiki-default-font-weight:bold",[391],{"type":28,"value":392},"new",{"type":23,"tag":122,"props":394,"children":395},{"style":135},[396],{"type":28,"value":238},{"type":23,"tag":122,"props":398,"children":400},{"style":399},"--shiki-default:#FFB86C;--shiki-default-font-style:italic",[401],{"type":28,"value":402},"RefCell",{"type":23,"tag":122,"props":404,"children":405},{"style":129},[406],{"type":28,"value":407},"::",{"type":23,"tag":122,"props":409,"children":410},{"style":389},[411],{"type":28,"value":392},{"type":23,"tag":122,"props":413,"children":414},{"style":135},[415],{"type":28,"value":238},{"type":23,"tag":122,"props":417,"children":418},{"style":399},[419],{"type":28,"value":420},"None",{"type":23,"tag":122,"props":422,"children":423},{"style":135},[424],{"type":28,"value":425},"));\n",{"type":23,"tag":122,"props":427,"children":428},{"class":124,"line":197},[429,434,438,443,448],{"type":23,"tag":122,"props":430,"children":431},{"style":135},[432],{"type":28,"value":433},"    let g ",{"type":23,"tag":122,"props":435,"children":436},{"style":129},[437],{"type":28,"value":290},{"type":23,"tag":122,"props":439,"children":440},{"style":135},[441],{"type":28,"value":442}," f.",{"type":23,"tag":122,"props":444,"children":445},{"style":230},[446],{"type":28,"value":447},"clone",{"type":23,"tag":122,"props":449,"children":450},{"style":135},[451],{"type":28,"value":452},"();\n",{"type":23,"tag":122,"props":454,"children":455},{"class":124,"line":221},[456,460,465,469,474,478],{"type":23,"tag":122,"props":457,"children":458},{"style":129},[459],{"type":28,"value":363},{"type":23,"tag":122,"props":461,"children":462},{"style":135},[463],{"type":28,"value":464}," mut keystate ",{"type":23,"tag":122,"props":466,"children":467},{"style":129},[468],{"type":28,"value":290},{"type":23,"tag":122,"props":470,"children":471},{"style":135},[472],{"type":28,"value":473}," KeyState::",{"type":23,"tag":122,"props":475,"children":476},{"style":389},[477],{"type":28,"value":392},{"type":23,"tag":122,"props":479,"children":480},{"style":135},[481],{"type":28,"value":452},{"type":23,"tag":122,"props":483,"children":484},{"class":124,"line":251},[485,490,495,500,505,509,514,519,524,529,534,539,543],{"type":23,"tag":122,"props":486,"children":487},{"style":129},[488],{"type":28,"value":489},"    *",{"type":23,"tag":122,"props":491,"children":492},{"style":135},[493],{"type":28,"value":494},"g.",{"type":23,"tag":122,"props":496,"children":497},{"style":230},[498],{"type":28,"value":499},"borrow_mut",{"type":23,"tag":122,"props":501,"children":502},{"style":135},[503],{"type":28,"value":504},"() ",{"type":23,"tag":122,"props":506,"children":507},{"style":129},[508],{"type":28,"value":290},{"type":23,"tag":122,"props":510,"children":511},{"style":230},[512],{"type":28,"value":513}," Some",{"type":23,"tag":122,"props":515,"children":516},{"style":135},[517],{"type":28,"value":518},"(browser::",{"type":23,"tag":122,"props":520,"children":521},{"style":230},[522],{"type":28,"value":523},"create_raf_closure",{"type":23,"tag":122,"props":525,"children":526},{"style":135},[527],{"type":28,"value":528},"(move ",{"type":23,"tag":122,"props":530,"children":531},{"style":129},[532],{"type":28,"value":533},"|",{"type":23,"tag":122,"props":535,"children":536},{"style":135},[537],{"type":28,"value":538},"perf: f64",{"type":23,"tag":122,"props":540,"children":541},{"style":129},[542],{"type":28,"value":533},{"type":23,"tag":122,"props":544,"children":545},{"style":135},[546],{"type":28,"value":547}," {\n",{"type":23,"tag":122,"props":549,"children":550},{"class":124,"line":270},[551,556,560,565,570,575,580,585,590,594,599],{"type":23,"tag":122,"props":552,"children":553},{"style":135},[554],{"type":28,"value":555},"        let _",{"type":23,"tag":122,"props":557,"children":558},{"style":129},[559],{"type":28,"value":290},{"type":23,"tag":122,"props":561,"children":562},{"style":135},[563],{"type":28,"value":564}," browser::",{"type":23,"tag":122,"props":566,"children":567},{"style":230},[568],{"type":28,"value":569},"request_animation_frame",{"type":23,"tag":122,"props":571,"children":572},{"style":135},[573],{"type":28,"value":574},"(f.",{"type":23,"tag":122,"props":576,"children":577},{"style":230},[578],{"type":28,"value":579},"borrow",{"type":23,"tag":122,"props":581,"children":582},{"style":135},[583],{"type":28,"value":584},"().",{"type":23,"tag":122,"props":586,"children":587},{"style":230},[588],{"type":28,"value":589},"as_ref",{"type":23,"tag":122,"props":591,"children":592},{"style":135},[593],{"type":28,"value":584},{"type":23,"tag":122,"props":595,"children":596},{"style":230},[597],{"type":28,"value":598},"unwrap",{"type":23,"tag":122,"props":600,"children":601},{"style":135},[602],{"type":28,"value":603},"());\n",{"type":23,"tag":122,"props":605,"children":606},{"class":124,"line":279},[607],{"type":23,"tag":122,"props":608,"children":609},{"style":135},[610],{"type":28,"value":611},"    }));\n",{"type":23,"tag":122,"props":613,"children":614},{"class":124,"line":298},[615,620,624],{"type":23,"tag":122,"props":616,"children":617},{"style":135},[618],{"type":28,"value":619},"    browser::",{"type":23,"tag":122,"props":621,"children":622},{"style":230},[623],{"type":28,"value":569},{"type":23,"tag":122,"props":625,"children":626},{"style":135},[627],{"type":28,"value":628},"(\n",{"type":23,"tag":122,"props":630,"children":632},{"class":124,"line":631},9,[633,638,642],{"type":23,"tag":122,"props":634,"children":635},{"style":135},[636],{"type":28,"value":637},"        g.",{"type":23,"tag":122,"props":639,"children":640},{"style":230},[641],{"type":28,"value":579},{"type":23,"tag":122,"props":643,"children":644},{"style":135},[645],{"type":28,"value":646},"()\n",{"type":23,"tag":122,"props":648,"children":650},{"class":124,"line":649},10,[651,656,660],{"type":23,"tag":122,"props":652,"children":653},{"style":135},[654],{"type":28,"value":655},"            .",{"type":23,"tag":122,"props":657,"children":658},{"style":230},[659],{"type":28,"value":589},{"type":23,"tag":122,"props":661,"children":662},{"style":135},[663],{"type":28,"value":646},{"type":23,"tag":122,"props":665,"children":667},{"class":124,"line":666},11,[668,672,677,681,686,691,696,700,706,712,716,721,726],{"type":23,"tag":122,"props":669,"children":670},{"style":135},[671],{"type":28,"value":655},{"type":23,"tag":122,"props":673,"children":674},{"style":230},[675],{"type":28,"value":676},"ok_or_else",{"type":23,"tag":122,"props":678,"children":679},{"style":135},[680],{"type":28,"value":238},{"type":23,"tag":122,"props":682,"children":683},{"style":129},[684],{"type":28,"value":685},"||",{"type":23,"tag":122,"props":687,"children":688},{"style":230},[689],{"type":28,"value":690}," anyhow",{"type":23,"tag":122,"props":692,"children":693},{"style":129},[694],{"type":28,"value":695},"!",{"type":23,"tag":122,"props":697,"children":698},{"style":135},[699],{"type":28,"value":238},{"type":23,"tag":122,"props":701,"children":703},{"style":702},"--shiki-default:#E9F284",[704],{"type":28,"value":705},"\"",{"type":23,"tag":122,"props":707,"children":709},{"style":708},"--shiki-default:#F1FA8C",[710],{"type":28,"value":711},"GameLoop: Loop is None",{"type":23,"tag":122,"props":713,"children":714},{"style":702},[715],{"type":28,"value":705},{"type":23,"tag":122,"props":717,"children":718},{"style":135},[719],{"type":28,"value":720},"))",{"type":23,"tag":122,"props":722,"children":723},{"style":129},[724],{"type":28,"value":725},"?",{"type":23,"tag":122,"props":727,"children":728},{"style":135},[729],{"type":28,"value":730},",\n",{"type":23,"tag":122,"props":732,"children":734},{"class":124,"line":733},12,[735,740,744],{"type":23,"tag":122,"props":736,"children":737},{"style":135},[738],{"type":28,"value":739},"    )",{"type":23,"tag":122,"props":741,"children":742},{"style":129},[743],{"type":28,"value":725},{"type":23,"tag":122,"props":745,"children":746},{"style":135},[747],{"type":28,"value":185},{"type":23,"tag":122,"props":749,"children":751},{"class":124,"line":750},13,[752,757],{"type":23,"tag":122,"props":753,"children":754},{"style":230},[755],{"type":28,"value":756},"    Ok",{"type":23,"tag":122,"props":758,"children":759},{"style":135},[760],{"type":28,"value":761},"(())\n",{"type":23,"tag":122,"props":763,"children":765},{"class":124,"line":764},14,[766],{"type":23,"tag":122,"props":767,"children":768},{"style":135},[769],{"type":28,"value":276},{"type":23,"tag":31,"props":771,"children":773},{"id":772},"it-was-a-fun-experience-to-code-a-game",[774],{"type":28,"value":775},"It was a fun experience to code a game",{"type":23,"tag":24,"props":777,"children":778},{},[779],{"type":28,"value":780},"Forty years ago, my first personal computer was an MSX2. I enjoyed programming by typing in the source code published in BASIC Magazine. The first program I typed was a racing game similar to the one I've created recently. Though my memory is a bit hazy, I recall the walls being represented by \"#\" and the car by a diamond character \"♢\". I remember spending hours correcting typos while referencing the magazine's source code. The joy I felt when the copied program finally ran is something I'll never forget. The excitement of seeing a program come to life hasn't changed at all, even now.",{"type":23,"tag":782,"props":783,"children":784},"style",{},[785],{"type":28,"value":786},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":7,"searchDepth":188,"depth":188,"links":788},[789,790,791],{"id":33,"depth":197,"text":36},{"id":96,"depth":197,"text":99},{"id":772,"depth":197,"text":775},"markdown","content:blogs:1. cart.md","content","blogs/1. cart.md","blogs/1. cart","md",{"loc":4},1729987161346]