[{"data":1,"prerenderedAt":790},["ShallowReactive",2],{"blog-post-/blogs/cart":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"date":10,"image":11,"alt":12,"ogImage":11,"tags":13,"published":17,"body":18,"_type":783,"_id":784,"_source":785,"_file":786,"_stem":787,"_extension":788,"sitemap":789},"/blogs/cart","blogs",false,"","Wasm Mini Game of Maze ðŸš—","Mini Game in Rust & Wasm","20th Oct 2024","/blogs-img/20241013.png","Vertical scrolling racing game",[14,15,16],"rust","wasm","webassembly",true,{"type":19,"children":20,"toc":777},"root",[21,30,36,41,53,63,69,74,84,297,305,734,740,745,751,761,771],{"type":22,"tag":23,"props":24,"children":26},"element","h2",{"id":25},"introduction",[27],{"type":28,"value":29},"text","Introduction",{"type":22,"tag":31,"props":32,"children":33},"p",{},[34],{"type":28,"value":35},"In the programming I usually do, a game loop is not necessary.\nHowever, it is necessary when programing games.",{"type":22,"tag":31,"props":37,"children":38},{},[39],{"type":28,"value":40},"I'm going to share some insights from my experience implementing a game loop with Rust and WASM.",{"type":22,"tag":31,"props":42,"children":43},{},[44],{"type":22,"tag":45,"props":46,"children":50},"a",{"href":47,"rel":48},"https://myurioka.github.io/cart/",[49],"nofollow",[51],{"type":28,"value":52},"Play in browser",{"type":22,"tag":31,"props":54,"children":55},{},[56],{"type":22,"tag":45,"props":57,"children":60},{"href":58,"rel":59},"https://github.com/myurioka/cart",[49],[61],{"type":28,"value":62},"Source",{"type":22,"tag":23,"props":64,"children":66},{"id":65},"what-i-learned",[67],{"type":28,"value":68},"What I learned",{"type":22,"tag":31,"props":70,"children":71},{},[72],{"type":28,"value":73},"Here are the websites I referred to when coding the game loop.",{"type":22,"tag":75,"props":76,"children":77},"ul",{},[78],{"type":22,"tag":79,"props":80,"children":81},"li",{},[82],{"type":28,"value":83},"The code has implemented a sophisticated technique to synchronize rendering with the browser's actual frame rate.",{"type":22,"tag":85,"props":86,"children":90},"pre",{"className":87,"code":88,"language":89,"meta":7,"style":7},"language-js shiki shiki-themes dracula","const FRAME_SIZE: f64 = 1.0 / 60.0 * 1000.0;\n\nwhile game_loop.accumulated_delta > FRAME_SIZE {\n    game.update(&keystate);\n    game_loop.accumulated_delta -= FRAME_SIZE;\n}\ngame_loop.last_frame = perf;\ngame.draw(&renderer);\n","js",[91],{"type":22,"tag":92,"props":93,"children":94},"code",{"__ignoreMap":7},[95,160,169,193,223,242,251,270],{"type":22,"tag":96,"props":97,"children":100},"span",{"class":98,"line":99},"line",1,[101,107,113,118,124,129,135,140,145,150,155],{"type":22,"tag":96,"props":102,"children":104},{"style":103},"--shiki-default:#FF79C6",[105],{"type":28,"value":106},"const",{"type":22,"tag":96,"props":108,"children":110},{"style":109},"--shiki-default:#F8F8F2",[111],{"type":28,"value":112}," FRAME_SIZE",{"type":22,"tag":96,"props":114,"children":115},{"style":103},[116],{"type":28,"value":117},":",{"type":22,"tag":96,"props":119,"children":121},{"style":120},"--shiki-default:#8BE9FD;--shiki-default-font-style:italic",[122],{"type":28,"value":123}," f64",{"type":22,"tag":96,"props":125,"children":126},{"style":103},[127],{"type":28,"value":128}," =",{"type":22,"tag":96,"props":130,"children":132},{"style":131},"--shiki-default:#BD93F9",[133],{"type":28,"value":134}," 1.0",{"type":22,"tag":96,"props":136,"children":137},{"style":103},[138],{"type":28,"value":139}," /",{"type":22,"tag":96,"props":141,"children":142},{"style":131},[143],{"type":28,"value":144}," 60.0",{"type":22,"tag":96,"props":146,"children":147},{"style":103},[148],{"type":28,"value":149}," *",{"type":22,"tag":96,"props":151,"children":152},{"style":131},[153],{"type":28,"value":154}," 1000.0",{"type":22,"tag":96,"props":156,"children":157},{"style":109},[158],{"type":28,"value":159},";\n",{"type":22,"tag":96,"props":161,"children":163},{"class":98,"line":162},2,[164],{"type":22,"tag":96,"props":165,"children":166},{"emptyLinePlaceholder":17},[167],{"type":28,"value":168},"\n",{"type":22,"tag":96,"props":170,"children":172},{"class":98,"line":171},3,[173,178,183,188],{"type":22,"tag":96,"props":174,"children":175},{"style":103},[176],{"type":28,"value":177},"while",{"type":22,"tag":96,"props":179,"children":180},{"style":109},[181],{"type":28,"value":182}," game_loop.accumulated_delta ",{"type":22,"tag":96,"props":184,"children":185},{"style":103},[186],{"type":28,"value":187},">",{"type":22,"tag":96,"props":189,"children":190},{"style":109},[191],{"type":28,"value":192}," FRAME_SIZE {\n",{"type":22,"tag":96,"props":194,"children":196},{"class":98,"line":195},4,[197,202,208,213,218],{"type":22,"tag":96,"props":198,"children":199},{"style":109},[200],{"type":28,"value":201},"    game.",{"type":22,"tag":96,"props":203,"children":205},{"style":204},"--shiki-default:#50FA7B",[206],{"type":28,"value":207},"update",{"type":22,"tag":96,"props":209,"children":210},{"style":109},[211],{"type":28,"value":212},"(",{"type":22,"tag":96,"props":214,"children":215},{"style":103},[216],{"type":28,"value":217},"&",{"type":22,"tag":96,"props":219,"children":220},{"style":109},[221],{"type":28,"value":222},"keystate);\n",{"type":22,"tag":96,"props":224,"children":226},{"class":98,"line":225},5,[227,232,237],{"type":22,"tag":96,"props":228,"children":229},{"style":109},[230],{"type":28,"value":231},"    game_loop.accumulated_delta ",{"type":22,"tag":96,"props":233,"children":234},{"style":103},[235],{"type":28,"value":236},"-=",{"type":22,"tag":96,"props":238,"children":239},{"style":109},[240],{"type":28,"value":241}," FRAME_SIZE;\n",{"type":22,"tag":96,"props":243,"children":245},{"class":98,"line":244},6,[246],{"type":22,"tag":96,"props":247,"children":248},{"style":109},[249],{"type":28,"value":250},"}\n",{"type":22,"tag":96,"props":252,"children":254},{"class":98,"line":253},7,[255,260,265],{"type":22,"tag":96,"props":256,"children":257},{"style":109},[258],{"type":28,"value":259},"game_loop.last_frame ",{"type":22,"tag":96,"props":261,"children":262},{"style":103},[263],{"type":28,"value":264},"=",{"type":22,"tag":96,"props":266,"children":267},{"style":109},[268],{"type":28,"value":269}," perf;\n",{"type":22,"tag":96,"props":271,"children":273},{"class":98,"line":272},8,[274,279,284,288,292],{"type":22,"tag":96,"props":275,"children":276},{"style":109},[277],{"type":28,"value":278},"game.",{"type":22,"tag":96,"props":280,"children":281},{"style":204},[282],{"type":28,"value":283},"draw",{"type":22,"tag":96,"props":285,"children":286},{"style":109},[287],{"type":28,"value":212},{"type":22,"tag":96,"props":289,"children":290},{"style":103},[291],{"type":28,"value":217},{"type":22,"tag":96,"props":293,"children":294},{"style":109},[295],{"type":28,"value":296},"renderer);\n",{"type":22,"tag":75,"props":298,"children":299},{},[300],{"type":22,"tag":79,"props":301,"children":302},{},[303],{"type":28,"value":304},"Rust ownership, particularly the concept of borrowing and lifetimes, is crucial for understanding this implementation.",{"type":22,"tag":85,"props":306,"children":308},{"className":87,"code":307,"language":89,"meta":7,"style":7},"impl GameLoop {\n    let f: SharedLoopClosure = Rc::new(RefCell::new(None));\n    let g = f.clone();\n    let mut keystate = KeyState::new();\n    *g.borrow_mut() = Some(browser::create_raf_closure(move |perf: f64| {\n        let _= browser::request_animation_frame(f.borrow().as_ref().unwrap());\n    }));\n    browser::request_animation_frame(\n        g.borrow()\n            .as_ref()\n            .ok_or_else(|| anyhow!(\"GameLoop: Loop is None\"))?,\n    )?;\n    Ok(())\n}\n",[309],{"type":22,"tag":92,"props":310,"children":311},{"__ignoreMap":7},[312,320,390,417,446,512,568,576,593,611,628,695,712,726],{"type":22,"tag":96,"props":313,"children":314},{"class":98,"line":99},[315],{"type":22,"tag":96,"props":316,"children":317},{"style":109},[318],{"type":28,"value":319},"impl GameLoop {\n",{"type":22,"tag":96,"props":321,"children":322},{"class":98,"line":162},[323,328,333,337,342,346,351,357,361,367,372,376,380,385],{"type":22,"tag":96,"props":324,"children":325},{"style":103},[326],{"type":28,"value":327},"    let",{"type":22,"tag":96,"props":329,"children":330},{"style":109},[331],{"type":28,"value":332}," f",{"type":22,"tag":96,"props":334,"children":335},{"style":103},[336],{"type":28,"value":117},{"type":22,"tag":96,"props":338,"children":339},{"style":120},[340],{"type":28,"value":341}," SharedLoopClosure",{"type":22,"tag":96,"props":343,"children":344},{"style":103},[345],{"type":28,"value":128},{"type":22,"tag":96,"props":347,"children":348},{"style":109},[349],{"type":28,"value":350}," Rc::",{"type":22,"tag":96,"props":352,"children":354},{"style":353},"--shiki-default:#FF79C6;--shiki-default-font-weight:bold",[355],{"type":28,"value":356},"new",{"type":22,"tag":96,"props":358,"children":359},{"style":109},[360],{"type":28,"value":212},{"type":22,"tag":96,"props":362,"children":364},{"style":363},"--shiki-default:#FFB86C;--shiki-default-font-style:italic",[365],{"type":28,"value":366},"RefCell",{"type":22,"tag":96,"props":368,"children":369},{"style":103},[370],{"type":28,"value":371},"::",{"type":22,"tag":96,"props":373,"children":374},{"style":353},[375],{"type":28,"value":356},{"type":22,"tag":96,"props":377,"children":378},{"style":109},[379],{"type":28,"value":212},{"type":22,"tag":96,"props":381,"children":382},{"style":363},[383],{"type":28,"value":384},"None",{"type":22,"tag":96,"props":386,"children":387},{"style":109},[388],{"type":28,"value":389},"));\n",{"type":22,"tag":96,"props":391,"children":392},{"class":98,"line":171},[393,398,402,407,412],{"type":22,"tag":96,"props":394,"children":395},{"style":109},[396],{"type":28,"value":397},"    let g ",{"type":22,"tag":96,"props":399,"children":400},{"style":103},[401],{"type":28,"value":264},{"type":22,"tag":96,"props":403,"children":404},{"style":109},[405],{"type":28,"value":406}," f.",{"type":22,"tag":96,"props":408,"children":409},{"style":204},[410],{"type":28,"value":411},"clone",{"type":22,"tag":96,"props":413,"children":414},{"style":109},[415],{"type":28,"value":416},"();\n",{"type":22,"tag":96,"props":418,"children":419},{"class":98,"line":195},[420,424,429,433,438,442],{"type":22,"tag":96,"props":421,"children":422},{"style":103},[423],{"type":28,"value":327},{"type":22,"tag":96,"props":425,"children":426},{"style":109},[427],{"type":28,"value":428}," mut keystate ",{"type":22,"tag":96,"props":430,"children":431},{"style":103},[432],{"type":28,"value":264},{"type":22,"tag":96,"props":434,"children":435},{"style":109},[436],{"type":28,"value":437}," KeyState::",{"type":22,"tag":96,"props":439,"children":440},{"style":353},[441],{"type":28,"value":356},{"type":22,"tag":96,"props":443,"children":444},{"style":109},[445],{"type":28,"value":416},{"type":22,"tag":96,"props":447,"children":448},{"class":98,"line":225},[449,454,459,464,469,473,478,483,488,493,498,503,507],{"type":22,"tag":96,"props":450,"children":451},{"style":103},[452],{"type":28,"value":453},"    *",{"type":22,"tag":96,"props":455,"children":456},{"style":109},[457],{"type":28,"value":458},"g.",{"type":22,"tag":96,"props":460,"children":461},{"style":204},[462],{"type":28,"value":463},"borrow_mut",{"type":22,"tag":96,"props":465,"children":466},{"style":109},[467],{"type":28,"value":468},"() ",{"type":22,"tag":96,"props":470,"children":471},{"style":103},[472],{"type":28,"value":264},{"type":22,"tag":96,"props":474,"children":475},{"style":204},[476],{"type":28,"value":477}," Some",{"type":22,"tag":96,"props":479,"children":480},{"style":109},[481],{"type":28,"value":482},"(browser::",{"type":22,"tag":96,"props":484,"children":485},{"style":204},[486],{"type":28,"value":487},"create_raf_closure",{"type":22,"tag":96,"props":489,"children":490},{"style":109},[491],{"type":28,"value":492},"(move ",{"type":22,"tag":96,"props":494,"children":495},{"style":103},[496],{"type":28,"value":497},"|",{"type":22,"tag":96,"props":499,"children":500},{"style":109},[501],{"type":28,"value":502},"perf: f64",{"type":22,"tag":96,"props":504,"children":505},{"style":103},[506],{"type":28,"value":497},{"type":22,"tag":96,"props":508,"children":509},{"style":109},[510],{"type":28,"value":511}," {\n",{"type":22,"tag":96,"props":513,"children":514},{"class":98,"line":244},[515,520,524,529,534,539,544,549,554,558,563],{"type":22,"tag":96,"props":516,"children":517},{"style":109},[518],{"type":28,"value":519},"        let _",{"type":22,"tag":96,"props":521,"children":522},{"style":103},[523],{"type":28,"value":264},{"type":22,"tag":96,"props":525,"children":526},{"style":109},[527],{"type":28,"value":528}," browser::",{"type":22,"tag":96,"props":530,"children":531},{"style":204},[532],{"type":28,"value":533},"request_animation_frame",{"type":22,"tag":96,"props":535,"children":536},{"style":109},[537],{"type":28,"value":538},"(f.",{"type":22,"tag":96,"props":540,"children":541},{"style":204},[542],{"type":28,"value":543},"borrow",{"type":22,"tag":96,"props":545,"children":546},{"style":109},[547],{"type":28,"value":548},"().",{"type":22,"tag":96,"props":550,"children":551},{"style":204},[552],{"type":28,"value":553},"as_ref",{"type":22,"tag":96,"props":555,"children":556},{"style":109},[557],{"type":28,"value":548},{"type":22,"tag":96,"props":559,"children":560},{"style":204},[561],{"type":28,"value":562},"unwrap",{"type":22,"tag":96,"props":564,"children":565},{"style":109},[566],{"type":28,"value":567},"());\n",{"type":22,"tag":96,"props":569,"children":570},{"class":98,"line":253},[571],{"type":22,"tag":96,"props":572,"children":573},{"style":109},[574],{"type":28,"value":575},"    }));\n",{"type":22,"tag":96,"props":577,"children":578},{"class":98,"line":272},[579,584,588],{"type":22,"tag":96,"props":580,"children":581},{"style":109},[582],{"type":28,"value":583},"    browser::",{"type":22,"tag":96,"props":585,"children":586},{"style":204},[587],{"type":28,"value":533},{"type":22,"tag":96,"props":589,"children":590},{"style":109},[591],{"type":28,"value":592},"(\n",{"type":22,"tag":96,"props":594,"children":596},{"class":98,"line":595},9,[597,602,606],{"type":22,"tag":96,"props":598,"children":599},{"style":109},[600],{"type":28,"value":601},"        g.",{"type":22,"tag":96,"props":603,"children":604},{"style":204},[605],{"type":28,"value":543},{"type":22,"tag":96,"props":607,"children":608},{"style":109},[609],{"type":28,"value":610},"()\n",{"type":22,"tag":96,"props":612,"children":614},{"class":98,"line":613},10,[615,620,624],{"type":22,"tag":96,"props":616,"children":617},{"style":109},[618],{"type":28,"value":619},"            .",{"type":22,"tag":96,"props":621,"children":622},{"style":204},[623],{"type":28,"value":553},{"type":22,"tag":96,"props":625,"children":626},{"style":109},[627],{"type":28,"value":610},{"type":22,"tag":96,"props":629,"children":631},{"class":98,"line":630},11,[632,636,641,645,650,655,660,664,670,676,680,685,690],{"type":22,"tag":96,"props":633,"children":634},{"style":109},[635],{"type":28,"value":619},{"type":22,"tag":96,"props":637,"children":638},{"style":204},[639],{"type":28,"value":640},"ok_or_else",{"type":22,"tag":96,"props":642,"children":643},{"style":109},[644],{"type":28,"value":212},{"type":22,"tag":96,"props":646,"children":647},{"style":103},[648],{"type":28,"value":649},"||",{"type":22,"tag":96,"props":651,"children":652},{"style":204},[653],{"type":28,"value":654}," anyhow",{"type":22,"tag":96,"props":656,"children":657},{"style":103},[658],{"type":28,"value":659},"!",{"type":22,"tag":96,"props":661,"children":662},{"style":109},[663],{"type":28,"value":212},{"type":22,"tag":96,"props":665,"children":667},{"style":666},"--shiki-default:#E9F284",[668],{"type":28,"value":669},"\"",{"type":22,"tag":96,"props":671,"children":673},{"style":672},"--shiki-default:#F1FA8C",[674],{"type":28,"value":675},"GameLoop: Loop is None",{"type":22,"tag":96,"props":677,"children":678},{"style":666},[679],{"type":28,"value":669},{"type":22,"tag":96,"props":681,"children":682},{"style":109},[683],{"type":28,"value":684},"))",{"type":22,"tag":96,"props":686,"children":687},{"style":103},[688],{"type":28,"value":689},"?",{"type":22,"tag":96,"props":691,"children":692},{"style":109},[693],{"type":28,"value":694},",\n",{"type":22,"tag":96,"props":696,"children":698},{"class":98,"line":697},12,[699,704,708],{"type":22,"tag":96,"props":700,"children":701},{"style":109},[702],{"type":28,"value":703},"    )",{"type":22,"tag":96,"props":705,"children":706},{"style":103},[707],{"type":28,"value":689},{"type":22,"tag":96,"props":709,"children":710},{"style":109},[711],{"type":28,"value":159},{"type":22,"tag":96,"props":713,"children":715},{"class":98,"line":714},13,[716,721],{"type":22,"tag":96,"props":717,"children":718},{"style":204},[719],{"type":28,"value":720},"    Ok",{"type":22,"tag":96,"props":722,"children":723},{"style":109},[724],{"type":28,"value":725},"(())\n",{"type":22,"tag":96,"props":727,"children":729},{"class":98,"line":728},14,[730],{"type":22,"tag":96,"props":731,"children":732},{"style":109},[733],{"type":28,"value":250},{"type":22,"tag":23,"props":735,"children":737},{"id":736},"what-was-fun-experience",[738],{"type":28,"value":739},"What was fun experience",{"type":22,"tag":31,"props":741,"children":742},{},[743],{"type":28,"value":744},"Forty years ago, my first personal computer was an MSX2. I enjoyed programming by typing in the source code published in BASIC Magazine. The first program I typed was a racing game similar to the one I've created recently. Though my memory is a bit hazy, I recall the walls being represented by \"#\" and the car by a diamond character \"â™¢\". I remember spending hours correcting typos while referencing the magazine's source code. The joy I felt when the copied program finally ran is something I'll never forget. The excitement of seeing a program come to life hasn't changed at all, even now.",{"type":22,"tag":23,"props":746,"children":748},{"id":747},"reference",[749],{"type":28,"value":750},"Reference",{"type":22,"tag":31,"props":752,"children":753},{},[754],{"type":22,"tag":45,"props":755,"children":758},{"href":756,"rel":757},"https://github.com/PacktPublishing/Game-Development-with-Rust-and-WebAssembly",[49],[759],{"type":28,"value":760},"Game-Development-with-Rust-and-WebAssembly",{"type":22,"tag":31,"props":762,"children":763},{},[764],{"type":22,"tag":45,"props":765,"children":768},{"href":766,"rel":767},"https://developer.mozilla.org/en-US/docs/Glossary/FPS",[49],[769],{"type":28,"value":770},"Browser Frame rate(FPS)",{"type":22,"tag":772,"props":773,"children":774},"style",{},[775],{"type":28,"value":776},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":7,"searchDepth":162,"depth":162,"links":778},[779,780,781,782],{"id":25,"depth":162,"text":29},{"id":65,"depth":162,"text":68},{"id":736,"depth":162,"text":739},{"id":747,"depth":162,"text":750},"markdown","content:blogs:1. cart.md","content","blogs/1. cart.md","blogs/1. cart","md",{"loc":4},1740912540765]